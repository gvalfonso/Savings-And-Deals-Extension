(()=>{"use strict";var e={136:function(e,i,t){var n=this&&this.__awaiter||function(e,i,t,n){return new(t||(t=Promise))((function(o,c){function s(e){try{a(n.next(e))}catch(e){c(e)}}function r(e){try{a(n.throw(e))}catch(e){c(e)}}function a(e){var i;e.done?o(e.value):(i=e.value,i instanceof t?i:new t((function(e){e(i)}))).then(s,r)}a((n=n.apply(e,i||[])).next())}))};Object.defineProperty(i,"__esModule",{value:!0}),i.settings=void 0;const o=t(593);function c(e,i){return n(this,void 0,void 0,(function*(){try{chrome.tabs.sendMessage(e,i)}catch(e){console.log("Message was sent too early.")}}))}function s(e,i){var t;const n=null===(t=i.split(" "))||void 0===t?void 0:t[0];var o=0;return n.includes("%")?o=e*+n.replace(/%/g,""):n.includes("₱")&&(o=1e5*+n.replace(/₱/g,""),n.includes("K")&&(o=1e5*+n.replace(/[₱K]/g,"")*1e3)),o||0}function r(e,i){return n(this,void 0,void 0,(function*(){return(yield fetch(`https://shopee.ph/api/v4/item/get?itemid=${e}&shopid=${i}`,{method:"GET",mode:"cors"})).json()}))}i.settings={iconHidden:!1},chrome.runtime.onMessage.addListener(((e,t,n)=>{"GET_CONFIG"===e.type&&n(i.settings)})),chrome.action.onClicked.addListener((e=>{chrome.tabs.query({active:!0,currentWindow:!0},(function(e){var t=e[0];i.settings.iconHidden=!i.settings.iconHidden,c(t.id||-1,{type:"TOGGLE"})}))})),chrome.tabs.onUpdated.addListener(((e,i,t)=>n(void 0,void 0,void 0,(function*(){var e,a,d,u,l,m,p,v,h;if("complete"===i.status&&t.url){const{shopid:i,itemid:f}=function(e){e=e.split("?")[0];var[i,t]=e.split("/").slice(4);return i&&t||([i,t]=e.split(".").slice(-2)),+i>0?{shopid:i,itemid:t}:{shopid:void 0,itemid:void 0}}(t.url);if(f&&i){c(t.id||-1,{type:"LOADING"});for(var _=yield r(f,i);!_.data;)_=yield r(f,i),yield(0,o.sleep)(5e3);const y=function(e,i){if(!i||0===i.length)return;const t=i.filter((i=>i.end_time>(new Date).getTime()/1e3&&i.min_spend<e));var n,o=0;return t.forEach((i=>{var t=i.discount_value||i.discount_percentage*e||0;i.discount_cap&&t>i.discount_cap&&(t=i.discount_cap),t>o&&(n=i,o=t)})),{highestVoucher:n,highestVoucherDiscountValue:o}}(_.data.price_min,_.data.shop_vouchers||[]);y&&(_.data.price_min=_.data.price_min-y.highestVoucherDiscountValue);const b=yield function(e){return n(this,void 0,void 0,(function*(){return(yield fetch(`https://shopee.ph/api/v4/search/search_items?by=relevancy&keyword=${encodeURIComponent(e)}&limit=60&newest=0&order=desc&page_type=search&scenario=PAGE_GLOBAL_SEARCH&version=2`,{method:"GET",mode:"cors"})).json()}))}(_.data.name),g=yield function(e,i,t,o){return n(this,void 0,void 0,(function*(){return(yield fetch(`https://shopee.ph/api/v4/recommend/recommend?bundle=product_detail_page&catid=${o}&item_card=3&itemid=${t}&keyword=${encodeURIComponent(e)}&limit=48&section=you_may_also_like&shopid=${i}`,{method:"GET",mode:"cors"})).json()}))}(_.data.name,_.data.shopid,_.data.itemid,(null===(e=_.data.categories)||void 0===e?void 0:e[0].catid)||0);b.items=[...b.items||[],...(null===(u=null===(d=null===(a=g.data.sections)||void 0===a?void 0:a[0])||void 0===d?void 0:d.data)||void 0===u?void 0:u.item).map((e=>({item_basic:e})))||[]],b.items=null===(l=b.items)||void 0===l?void 0:l.filter((e=>e.item_basic)),b.items=null===(m=b.items)||void 0===m?void 0:m.filter((e=>(e.item_basic.voucher_info?e.item_basic.price_min-s(e.item_basic.price_min,e.item_basic.voucher_info.label):e.item_basic.price_min)<_.data.price_min&&e.item_basic.sold>0&&e.item_basic.item_rating.rating_star>4&&e.item_basic.itemid.toString()!=f)),null===(p=b.items)||void 0===p||p.forEach((e=>{var i;return e.item_basic.price_min=e.item_basic.price_min-s(e.item_basic.price_min,(null===(i=e.item_basic.voucher_info)||void 0===i?void 0:i.label)||"")}));const w=null===(h=null===(v=b.items)||void 0===v?void 0:v.filter((e=>e.item_basic.price_min/_.data.price_min>.1)))||void 0===h?void 0:h.slice(0,10).sort(((e,i)=>e.item_basic.price_min-i.item_basic.price_min));c(t.id||-1,{type:"SUGGESTIONS",items:w||[]})}else c(t.id||-1,{type:"LOADING"})}}))))},593:function(e,i){var t=this&&this.__awaiter||function(e,i,t,n){return new(t||(t=Promise))((function(o,c){function s(e){try{a(n.next(e))}catch(e){c(e)}}function r(e){try{a(n.throw(e))}catch(e){c(e)}}function a(e){var i;e.done?o(e.value):(i=e.value,i instanceof t?i:new t((function(e){e(i)}))).then(s,r)}a((n=n.apply(e,i||[])).next())}))};Object.defineProperty(i,"__esModule",{value:!0}),i.sleep=void 0,i.sleep=function(e){return t(this,void 0,void 0,(function*(){return new Promise(((i,t)=>setTimeout(i,e)))}))}}},i={};!function t(n){var o=i[n];if(void 0!==o)return o.exports;var c=i[n]={exports:{}};return e[n].call(c.exports,c,c.exports,t),c.exports}(136)})();